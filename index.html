<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Calendar</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Using Inter font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Ensure consistent height for calendar cells */
        .calendar-day {
            height: 12vh;
            min-height: 80px;
            max-height: 120px;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 flex items-center justify-center min-h-screen p-4 transition-colors duration-200">

    <div class="w-full max-w-4xl bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden">
        
        <!-- Calendar Header: Month/Year and Navigation -->
        <div class="flex items-center justify-between px-6 py-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600">
            <button id="prev-month" aria-label="Previous Month" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            </button>
            <h2 id="month-year" class="text-2xl font-semibold text-gray-800 dark:text-gray-100"></h2>
            <button id="next-month" aria-label="Next Month" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </button>
        </div>

        <!-- Selection Info Bar -->
        <div class="px-6 py-3 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600 flex items-center justify-between">
            <div id="selection-info" class="text-sm text-gray-700 dark:text-gray-200">No dates selected. Click a start date, then an end date. Tip: hold Shift on second click or click and drag to select.</div>
            <div class="flex items-center space-x-2">
                <button id="clear-selection" class="px-3 py-1.5 text-sm rounded-md bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-600">Clear</button>
            </div>
        </div>

        <!-- Calendar Grid -->
        <div class="p-2">
            <!-- Days of the Week Header -->
            <div class="grid grid-cols-7 gap-px">
                <div class="text-center text-sm font-medium text-gray-500 dark:text-gray-400 py-2 uppercase tracking-wider">Sun</div>
                <div class="text-center text-sm font-medium text-gray-500 dark:text-gray-400 py-2 uppercase tracking-wider">Mon</div>
                <div class="text-center text-sm font-medium text-gray-500 dark:text-gray-400 py-2 uppercase tracking-wider">Tue</div>
                <div class="text-center text-sm font-medium text-gray-500 dark:text-gray-400 py-2 uppercase tracking-wider">Wed</div>
                <div class="text-center text-sm font-medium text-gray-500 dark:text-gray-400 py-2 uppercase tracking-wider">Thu</div>
                <div class="text-center text-sm font-medium text-gray-500 dark:text-gray-400 py-2 uppercase tracking-wider">Fri</div>
                <div class="text-center text-sm font-medium text-gray-500 dark:text-gray-400 py-2 uppercase tracking-wider">Sat</div>
            </div>

            <!-- Calendar Days -->
            <div id="calendar-days" role="grid" aria-label="Monthly calendar" class="grid grid-cols-7 gap-px bg-gray-200 dark:bg-gray-600 border-t border-l border-gray-200 dark:border-gray-600">
                <!-- Days will be generated by JavaScript -->
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const monthYearEl = document.getElementById('month-year');
            const daysEl = document.getElementById('calendar-days');
            const prevBtn = document.getElementById('prev-month');
            const nextBtn = document.getElementById('next-month');
            const selectionInfoEl = document.getElementById('selection-info');
            const clearBtn = document.getElementById('clear-selection');

            // Use a date object to track the currently displayed month
            let currentDate = new Date();
            // Set to the first day of the month to avoid day-related issues
            currentDate.setDate(1); 

            const today = new Date();
            normalizeLocalMidnight(today);

            // Selection state
            let selectedStart = null;
            let selectedEnd = null;
            let isDragging = false;

            function renderCalendar() {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth(); // 0-11

                // 1. Set Month/Year Header
                monthYearEl.textContent = `${currentDate.toLocaleString('default', { month: 'long' })} ${year}`;

                // 2. Clear previous days
                daysEl.innerHTML = '';

                // 3. Get calendar calculation values
                const firstDayOfMonth = new Date(year, month, 1).getDay(); // 0=Sun, 1=Mon...
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const daysInPrevMonth = new Date(year, month, 0).getDate();

                // 4. Calculate padding days from the previous month
                const prevMonthPaddingDays = firstDayOfMonth;

                // 5. Render previous month's padding days
                for (let i = 0; i < prevMonthPaddingDays; i++) {
                    const day = daysInPrevMonth - prevMonthPaddingDays + i + 1;
                    const dateObj = new Date(year, month - 1, day);
                    normalizeLocalMidnight(dateObj);
                    daysEl.appendChild(createDayElement(dateObj, false, isSameDate(dateObj, today)));
                }

                // 6. Render current month's days
                for (let i = 1; i <= daysInMonth; i++) {
                    const dateObj = new Date(year, month, i);
                    normalizeLocalMidnight(dateObj);
                    const isToday = isSameDate(dateObj, today);
                    daysEl.appendChild(createDayElement(dateObj, true, isToday));
                }

                // 7. Calculate and render next month's padding days
                const totalDaysRendered = prevMonthPaddingDays + daysInMonth;
                const nextMonthPaddingDays = (7 - (totalDaysRendered % 7)) % 7; // Ensure it wraps to 0 if total is multiple of 7

                for (let i = 1; i <= nextMonthPaddingDays; i++) {
                    const dateObj = new Date(year, month + 1, i);
                    normalizeLocalMidnight(dateObj);
                    daysEl.appendChild(createDayElement(dateObj, false, isSameDate(dateObj, today)));
                }

                updateSelectionInfo();
            }

            /**
             * Helper function to create a day element
             * @param {Date} dateObj - The actual date represented by this cell
             * @param {boolean} isCurrentMonth - Flag for current month
             * @param {boolean} isToday - Flag for today's date
             */
            function createDayElement(dateObj, isCurrentMonth, isToday) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day p-2 bg-white dark:bg-gray-800 relative transition duration-150 ease-in-out cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-600';
                dayDiv.setAttribute('role', 'gridcell');
                dayDiv.setAttribute('tabindex', '0');
                dayDiv.dataset.date = formatDateKey(dateObj);
                dayDiv.title = dateObj.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

                const dayNumber = document.createElement('span');
                dayNumber.textContent = dateObj.getDate();

                if (isToday) {
                    dayNumber.className = 'absolute top-1 right-2 w-7 h-7 flex items-center justify-center bg-blue-600 text-white rounded-full font-semibold';
                    dayDiv.classList.add('font-semibold');
                    dayDiv.setAttribute('aria-current', 'date');
                } else if (isCurrentMonth) {
                    dayNumber.className = 'absolute top-2 right-2 text-gray-700 dark:text-gray-200';
                } else {
                    dayNumber.className = 'absolute top-2 right-2 text-gray-400 dark:text-gray-500';
                    dayDiv.classList.add('bg-gray-50', 'dark:bg-gray-700');
                }

                const inRange = isDateInRange(dateObj, selectedStart, selectedEnd);
                const isStart = selectedStart && isSameDate(dateObj, selectedStart);
                const isEnd = selectedEnd && isSameDate(dateObj, selectedEnd);

                if (inRange) {
                    dayDiv.classList.add('bg-blue-50', 'dark:bg-blue-900/20');
                    dayDiv.classList.add('ring-1', 'ring-blue-200', 'dark:ring-blue-700');
                    dayDiv.setAttribute('aria-selected', 'true');
                } else {
                    dayDiv.setAttribute('aria-selected', 'false');
                }

                if (isStart || isEnd) {
                    dayDiv.classList.add('outline', 'outline-2', 'outline-blue-600');
                }

                dayDiv.appendChild(dayNumber);
                return dayDiv;
            }

            function normalizeLocalMidnight(d) {
                d.setHours(0, 0, 0, 0);
            }

            function formatDateKey(d) {
                const y = d.getFullYear();
                const m = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                return `${y}-${m}-${day}`;
            }

            function parseDateKey(key) {
                const [y, m, d] = key.split('-').map(Number);
                const dt = new Date(y, m - 1, d);
                normalizeLocalMidnight(dt);
                return dt;
            }

            function isSameDate(a, b) {
                if (!a || !b) return false;
                return a.getFullYear() === b.getFullYear() && a.getMonth() === b.getMonth() && a.getDate() === b.getDate();
            }

            function utcMidnightMs(d) {
                return Date.UTC(d.getFullYear(), d.getMonth(), d.getDate());
            }

            function isDateInRange(dateObj, start, end) {
                if (!start || !end) return false;
                const x = utcMidnightMs(dateObj);
                const a = utcMidnightMs(start);
                const b = utcMidnightMs(end);
                const min = Math.min(a, b);
                const max = Math.max(a, b);
                return x >= min && x <= max;
            }

            function getDayCounts(start, end) {
                const a = utcMidnightMs(start);
                const b = utcMidnightMs(end);
                const diffDays = Math.abs(Math.round((b - a) / 86400000));
                const between = Math.max(0, diffDays - 1);
                const spanned = diffDays + 1;
                return { between, spanned, diffDays };
            }

            function formatPretty(d) {
                return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
            }

            function updateSelectionInfo() {
                if (!selectedStart && !selectedEnd) {
                    selectionInfoEl.textContent = 'No dates selected. Click a start date, then an end date. Tip: hold Shift on second click or click and drag to select.';
                    return;
                }

                if (selectedStart && !selectedEnd) {
                    selectionInfoEl.textContent = `Start: ${formatPretty(selectedStart)} — choose an end date.`;
                    return;
                }

                if (selectedStart && selectedEnd) {
                    const { between, spanned } = getDayCounts(selectedStart, selectedEnd);
                    const startText = formatPretty(selectedStart);
                    const endText = formatPretty(selectedEnd);
                    selectionInfoEl.innerHTML = `Range: <span class="font-semibold">${startText}</span> → <span class="font-semibold">${endText}</span> • Between (exclusive): <span class="font-semibold">${between}</span> day${between === 1 ? '' : 's'} • Span (inclusive): <span class="font-semibold">${spanned}</span> day${spanned === 1 ? '' : 's'}`;
                }
            }

            // --- Event Listeners ---
            prevBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                isDragging = false;
                renderCalendar();
            });

            nextBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                isDragging = false;
                renderCalendar();
            });

            clearBtn.addEventListener('click', () => {
                selectedStart = null;
                selectedEnd = null;
                isDragging = false;
                renderCalendar();
            });

            // Click selection (with Shift support)
            daysEl.addEventListener('click', (e) => {
                if (isDragging) return; // drag finalizes on mouseup
                const cell = e.target.closest('.calendar-day');
                if (!cell) return;
                const date = parseDateKey(cell.dataset.date);

                if (e.shiftKey && selectedStart) {
                    selectedEnd = date;
                } else if (!selectedStart || (selectedStart && selectedEnd)) {
                    selectedStart = date;
                    selectedEnd = null;
                } else if (selectedStart && !selectedEnd) {
                    selectedEnd = date;
                }
                renderCalendar();
            });

            // Drag selection
            daysEl.addEventListener('mousedown', (e) => {
                const cell = e.target.closest('.calendar-day');
                if (!cell) return;
                const date = parseDateKey(cell.dataset.date);
                selectedStart = date;
                selectedEnd = null;
                isDragging = true;
                renderCalendar();
            });

            daysEl.addEventListener('mouseover', (e) => {
                if (!isDragging || !selectedStart) return;
                const cell = e.target.closest('.calendar-day');
                if (!cell) return;
                selectedEnd = parseDateKey(cell.dataset.date);
                renderCalendar();
            });

            document.addEventListener('mouseup', () => {
                if (!isDragging) return;
                isDragging = false;
                updateSelectionInfo();
            });

            // Keyboard interactions
            daysEl.addEventListener('keydown', (e) => {
                const cell = e.target.closest('.calendar-day');
                if (!cell) return;
                if (e.key === 'Escape') {
                    selectedStart = null;
                    selectedEnd = null;
                    isDragging = false;
                    renderCalendar();
                    return;
                }
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    const date = parseDateKey(cell.dataset.date);
                    if (e.shiftKey && selectedStart) {
                        selectedEnd = date;
                    } else if (!selectedStart || (selectedStart && selectedEnd)) {
                        selectedStart = date;
                        selectedEnd = null;
                    } else {
                        selectedEnd = date;
                    }
                    renderCalendar();
                }
            });

            // --- Initial Render ---
            renderCalendar();
        });
    </script>
</body>
</html>

